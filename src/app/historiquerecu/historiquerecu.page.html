<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Rapport de Ventes</ion-title>
    <ion-buttons slot="start" (click)="menuApp()">
      <ion-icon slot="icon-only" name="menu"></ion-icon>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Filtre par date -->
  <ion-list>
    <ion-item>
      <ion-label>Date début</ion-label>
      <ion-input type="date" [(ngModel)]="daterecustock"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label>Date fin</ion-label>
      <ion-input type="date" [(ngModel)]="datefinstock"></ion-input>
    </ion-item>
    <ion-item>
      <ion-button expand="full" color="warning" (click)="loadSalesReport()">
        Rechercher
      </ion-button>
    </ion-item>
  </ion-list>
  

  <ng-container *ngIf="customers.length === 0">
    <div class="no-stock-message">
      Aucun rapport pour cette période.
    </div>
  </ng-container>

  <ion-list *ngIf="customers.length > 0">
    <ion-item *ngFor="let emp of customers; let i = index" class="report-item">
      <ion-grid>
        <ion-row>
          <ion-col size="6">
            <h2 class="emp-name">{{ emp.employee_name }}</h2>
            <ion-button size="small" fill="outline" (click)="emp.showDetails = !emp.showDetails">
              {{ emp.showDetails ? 'Masquer' : 'Voir' }}
            </ion-button>
          </ion-col>
  
          <!-- colonne totaux (décalée vers la gauche pour laisser espace au bouton) -->
          <ion-col size="6" class="totals-col">
            <div class="tot-line"><strong>Pièces:</strong> {{ emp.total_pieces | number:'1.0-0' }}</div>
            <div class="tot-line"><strong>Poids:</strong> {{ emp.total_poids | number:'1.2-2' }} g</div>
            <div class="tot-line"><strong>Montant:</strong> <span class="montant">{{ emp.total_vente | number:'1.0-0' }} FCFA</span></div>
          </ion-col>
  
         
        </ion-row>
  
        <!-- détails expandables -->
        <ion-row *ngIf="emp.showDetails" class="details-row">
          <ion-col size="12">
            <ion-list lines="none">
              <ion-item *ngFor="let d of emp.details_list">
                <ion-label>
                  <div class="detail-title">{{ d.type_or || '-' }}</div>
                  <div class="detail-meta">
                    <span>{{ d.total_pieces | number:'1.0-0' }} p</span>
                    &nbsp;•&nbsp;
                    <span>{{ d.total_poids | number:'1.2-2' }} g</span>
                    &nbsp;•&nbsp;
                    <span>{{ d.total_vente | number:'1.0-0' }} FCFA</span>
                  </div>
                </ion-label>
              </ion-item>
            </ion-list>
  
            <div class="details-footer">
              <strong>Total titres:</strong> {{ emp.details_list.length }}
              &nbsp;•&nbsp;
              <strong>Poids:</strong> {{ emp.details_totals.poids | number:'1.2-2' }} g
              &nbsp;•&nbsp;
              <strong>Montant:</strong> {{ emp.details_totals.montant | number:'1.0-0' }} FCFA
            </div>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-item>
  </ion-list>

  <style>
    .no-stock-message {
      text-align: center;
      padding: 20px;
      font-weight: bold;
      font-size: 14pt;
      color: red;
    }
    ion-item {
      margin-bottom: 5px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      background-color: #fdf6e3;
    }
  </style>
</ion-content>

<ion-footer>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon> Retour
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
